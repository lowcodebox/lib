syntax = "proto3";

package analytic_collector;

option go_package = ".";

import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";


message Event {
	string storage = 1;
	repeated EventItem items = 2;
	string payload = 3;
	google.protobuf.Timestamp timestamp = 4;
}

message EventItem {
	string field = 1;
	string value = 2;
}

message SetRequest {
	repeated Event Events = 1;
}

message SetResponse {
	bool status = 1;
	repeated string uids = 2;
	string error = 3;
}

message SearchRequest {
	string storage = 1;
	repeated EventItem items = 2;
	int64 count = 3;
	int64 offset = 4;
	string orderField = 5;
	bool asc = 6;
}

message SearchResponse {
	repeated Event events = 1;
	Metrics metrics = 2;
	string error = 3;
}

message Metrics {
	uint64 ResultCount = 2;
	int64 ResultOffset = 3;
	int64 ResultLimit = 4;
}

message QueryRequest{
	string UID = 1;
	int64 Offset = 2;
	google.protobuf.ListValue Params = 3;
}

message QueryResponse{
	repeated google.protobuf.Struct Data = 1;
}

service Collector {
	rpc Set(SetRequest) returns (SetResponse);
	rpc Search(SearchRequest) returns (SearchResponse);
	rpc Query(QueryRequest) returns (QueryResponse);
}
